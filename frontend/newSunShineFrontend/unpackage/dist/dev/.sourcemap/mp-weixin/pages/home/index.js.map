{"version":3,"file":"index.js","sources":["pages/home/index.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9pbmRleC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <!-- 顶部：搜索栏与头像/入口 -->\r\n    <view class=\"top-bar\">\r\n      <view class=\"search-box\">\r\n        <input class=\"search-input\" type=\"text\" v-model=\"searchKeyword\" placeholder=\"搜索商品/分类\" confirm-type=\"search\" @confirm=\"onSearch\" />\r\n        <button class=\"search-btn\" @click=\"onSearch\">搜索</button>\r\n      </view>\r\n      <view class=\"user-entry\" @click=\"goToProfile\">\r\n        <image class=\"avatar\" :src=\"userAvatar\" mode=\"aspectFill\"></image>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 轮播图 -->\r\n    <swiper class=\"banner\" :indicator-dots=\"true\" :circular=\"true\" :autoplay=\"true\" :interval=\"4000\" :duration=\"500\">\r\n      <swiper-item v-for=\"item in banners\" :key=\"item.id\" @click=\"onBannerClick(item)\">\r\n        <image class=\"banner-img\" :src=\"item.image\" mode=\"aspectFill\" />\r\n      </swiper-item>\r\n    </swiper>\r\n\r\n    <!-- 功能入口网格 -->\r\n    <view class=\"feature-grid\">\r\n      <view class=\"feature-item\" @click=\"goToProducts\">\r\n        <text class=\"icon\">🛍️</text>\r\n        <text class=\"label\">商品浏览</text>\r\n      </view>\r\n      <view class=\"feature-item\" @click=\"goToCart\">\r\n        <text class=\"icon\">🛒</text>\r\n        <text class=\"label\">购物车</text>\r\n      </view>\r\n      <view class=\"feature-item\" @click=\"goToOrders\">\r\n        <text class=\"icon\">📦</text>\r\n        <text class=\"label\">我的订单</text>\r\n      </view>\r\n      <view class=\"feature-item\" @click=\"goToProfile\">\r\n        <text class=\"icon\">👤</text>\r\n        <text class=\"label\">个人中心</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 分类快捷（横滑） -->\r\n    <scroll-view class=\"category-scroll\" scroll-x v-if=\"categories.length\">\r\n      <view :class=\"['cat-chip', activeCategory===cat ? 'active' : '']\" v-for=\"cat in categories\" :key=\"cat\" @click=\"onSelectCategory(cat)\">{{ cat }}</view>\r\n      <view :class=\"['cat-chip', activeCategory==='' ? 'active' : '']\" @click=\"onSelectCategory('')\">全部</view>\r\n    </scroll-view>\r\n\r\n    <!-- 推荐商品 -->\r\n    <view class=\"section-title\">\r\n      <text>热门推荐</text>\r\n      <text class=\"more\" @click=\"goToProducts\">更多 ></text>\r\n    </view>\r\n\r\n    <view class=\"product-list\">\r\n      <view class=\"product-card\" v-for=\"item in products\" :key=\"item.id\" @click=\"goProductDetail(item.id)\">\r\n        <image class=\"cover\" :src=\"item.image || defaultImage\" mode=\"aspectFill\" />\r\n        <view class=\"p-name\">{{ item.name }}</view>\r\n        <view class=\"p-bottom\">\r\n          <text class=\"p-price\">¥ {{ formatPrice(item.price) }}</text>\r\n          <text class=\"p-tag\" v-if=\"item.category\">{{ item.category }}</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"empty\" v-if=\"!loading && !products.length\">\r\n      <text>暂无推荐商品</text>\r\n    </view>\r\n\r\n    <view class=\"loading\" v-if=\"loading\">加载中...</view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      searchKeyword: '',\r\n      banners: [\r\n        { id: 1, image: '/static/logo.png', link: '/pages/home/product-list' },\r\n        { id: 2, image: '/static/logo.png', link: '/pages/home/product-list' }\r\n      ],\r\n      categories: [],\r\n      activeCategory: '',\r\n      products: [],\r\n      loading: false,\r\n      defaultImage: '/static/logo.png',\r\n      userAvatar: '/static/logo.png'\r\n    };\r\n  },\r\n  onShow() {\r\n    this.init();\r\n  },\r\n  methods: {\r\n    async init() {\r\n      this.loadUserAvatar();\r\n      await Promise.all([\r\n        this.fetchCategories(),\r\n        this.fetchProducts()\r\n      ]);\r\n    },\r\n    loadUserAvatar() {\r\n      try {\r\n        const profile = uni.getStorageSync('userInfo');\r\n        if (profile && profile.avatar_url) this.userAvatar = profile.avatar_url;\r\n      } catch (e) {}\r\n    },\r\n    async fetchCategories() {\r\n      try {\r\n        const res = await this.$api.products.getCategories();\r\n        const response = res[1] || res; // 兼容uni.request返回格式\r\n        if (response && response.statusCode === 200 && response.data && response.data.code === 200) {\r\n          this.categories = response.data.data || [];\r\n        } else {\r\n          console.warn('获取分类失败:', response?.data?.msg || '未知错误');\r\n        }\r\n      } catch (e) {\r\n        console.error('获取分类错误:', e);\r\n        // 分类失败不影响主流程\r\n      }\r\n    },\r\n    async fetchProducts() {\r\n      this.loading = true;\r\n      try {\r\n        const params = { page: 1, pageSize: 6, sortBy: 'created_at', sortOrder: 'DESC' };\r\n        if (this.activeCategory) params.category = this.activeCategory;\r\n        \r\n        console.log('首页请求推荐商品参数:', params);\r\n        const res = await this.$api.products.getProducts(params);\r\n        const response = res[1] || res;\r\n        \r\n        console.log('首页商品接口响应:', response);\r\n        \r\n        if (response && response.statusCode === 200 && response.data && response.data.code === 200) {\r\n          this.products = response.data.data.list || [];\r\n          console.log('首页推荐商品加载成功，共', this.products.length, '个商品');\r\n        } else {\r\n          console.warn('首页获取商品失败:', response?.data?.msg || '未知错误');\r\n          this.products = [];\r\n        }\r\n      } catch (e) {\r\n        console.error('首页获取商品错误:', e);\r\n        this.products = [];\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    onSearch() {\r\n      const keyword = (this.searchKeyword || '').trim();\r\n      this.$router.navigateTo(`/pages/home/product-list?search=${encodeURIComponent(keyword)}`);\r\n    },\r\n    onBannerClick(item) {\r\n      if (item && item.link) this.$router.navigateTo(item.link);\r\n    },\r\n    onSelectCategory(cat) {\r\n      this.activeCategory = cat;\r\n      this.fetchProducts();\r\n    },\r\n    goToProducts() {\r\n      this.$router.switchTab('/pages/home/product-list');\r\n    },\r\n    goToCart() {\r\n      this.$router.switchTab('/pages/home/shopping-cart');\r\n    },\r\n    goToOrders() {\r\n      this.$router.navigateTo('/pages/home/my-orders');\r\n    },\r\n    goToProfile() {\r\n      this.$router.switchTab('/pages/account/profile');\r\n    },\r\n    goProductDetail(id) {\r\n      this.$router.navigateTo(`/pages/home/product-detail?id=${id}`);\r\n    },\r\n    formatPrice(v) {\r\n      const n = Number(v || 0);\r\n      return n.toFixed(2);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.page {\r\n  background: #f5f5f5;\r\n  min-height: 100vh;\r\n  padding-bottom: 32rpx;\r\n}\r\n\r\n.top-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 24rpx 24rpx 0 24rpx;\r\n}\r\n\r\n.search-box {\r\n  flex: 1;\r\n  display: flex;\r\n  background: #ffffff;\r\n  border-radius: 999rpx;\r\n  padding: 8rpx 8rpx 8rpx 24rpx;\r\n}\r\n.search-input {\r\n  flex: 1;\r\n  font-size: 28rpx;\r\n}\r\n.search-btn {\r\n  margin-left: 8rpx;\r\n  background: #07c160;\r\n  color: #fff;\r\n  border-radius: 999rpx;\r\n  font-size: 26rpx;\r\n  padding: 0 24rpx;\r\n}\r\n.user-entry {\r\n  margin-left: 16rpx;\r\n}\r\n.avatar {\r\n  width: 64rpx;\r\n  height: 64rpx;\r\n  border-radius: 50%;\r\n}\r\n\r\n.banner {\r\n  height: 300rpx;\r\n  margin: 24rpx;\r\n  border-radius: 16rpx;\r\n  overflow: hidden;\r\n}\r\n.banner-img {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.feature-grid {\r\n  margin: 0 24rpx 8rpx 24rpx;\r\n  background: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 24rpx 12rpx;\r\n  display: grid;\r\n  grid-template-columns: repeat(4, 1fr);\r\n  grid-gap: 12rpx;\r\n}\r\n.feature-item {\r\n  background: #f8f8f8;\r\n  border-radius: 12rpx;\r\n  padding: 24rpx 0;\r\n  text-align: center;\r\n}\r\n.icon {\r\n  font-size: 40rpx;\r\n  display: block;\r\n}\r\n.label {\r\n  margin-top: 8rpx;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.category-scroll {\r\n  white-space: nowrap;\r\n  margin: 8rpx 24rpx;\r\n}\r\n.cat-chip {\r\n  display: inline-block;\r\n  padding: 10rpx 20rpx;\r\n  margin-right: 12rpx;\r\n  background: #ffffff;\r\n  border-radius: 999rpx;\r\n  font-size: 24rpx;\r\n  color: #333;\r\n}\r\n.cat-chip.active {\r\n  background: #07c160;\r\n  color: #fff;\r\n}\r\n\r\n.section-title {\r\n  margin: 24rpx 24rpx 12rpx 24rpx;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  font-size: 30rpx;\r\n}\r\n.section-title .more {\r\n  color: #666;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.product-list {\r\n  margin: 0 24rpx;\r\n  display: grid;\r\n  grid-template-columns: repeat(2, 1fr);\r\n  grid-gap: 16rpx;\r\n}\r\n.product-card {\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  overflow: hidden;\r\n  padding-bottom: 12rpx;\r\n}\r\n.cover {\r\n  width: 100%;\r\n  height: 300rpx;\r\n  background: #f0f0f0;\r\n}\r\n.p-name {\r\n  font-size: 26rpx;\r\n  color: #111;\r\n  padding: 12rpx 12rpx 4rpx 12rpx;\r\n  line-height: 36rpx;\r\n  height: 72rpx;\r\n  overflow: hidden;\r\n}\r\n.p-bottom {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 12rpx;\r\n}\r\n.p-price {\r\n  color: #e33;\r\n  font-weight: bold;\r\n}\r\n.p-tag {\r\n  font-size: 22rpx;\r\n  color: #999;\r\n}\r\n\r\n.empty {\r\n  text-align: center;\r\n  color: #999;\r\n  padding: 48rpx 0;\r\n}\r\n.loading {\r\n  text-align: center;\r\n  color: #666;\r\n  padding: 24rpx 0 48rpx 0;\r\n}\r\n</style> ","import MiniProgramPage from 'D:/newSunShinestore/frontend/newSunShineFrontend/pages/home/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAwEA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,eAAe;AAAA,MACf,SAAS;AAAA,QACP,EAAE,IAAI,GAAG,OAAO,oBAAoB,MAAM,2BAA4B;AAAA,QACtE,EAAE,IAAI,GAAG,OAAO,oBAAoB,MAAM,2BAA2B;AAAA,MACtE;AAAA,MACD,YAAY,CAAE;AAAA,MACd,gBAAgB;AAAA,MAChB,UAAU,CAAE;AAAA,MACZ,SAAS;AAAA,MACT,cAAc;AAAA,MACd,YAAY;AAAA;EAEf;AAAA,EACD,SAAS;AACP,SAAK,KAAI;AAAA,EACV;AAAA,EACD,SAAS;AAAA,IACP,MAAM,OAAO;AACX,WAAK,eAAc;AACnB,YAAM,QAAQ,IAAI;AAAA,QAChB,KAAK,gBAAiB;AAAA,QACtB,KAAK,cAAc;AAAA,MACrB,CAAC;AAAA,IACF;AAAA,IACD,iBAAiB;AACf,UAAI;AACF,cAAM,UAAUA,cAAAA,MAAI,eAAe,UAAU;AAC7C,YAAI,WAAW,QAAQ;AAAY,eAAK,aAAa,QAAQ;AAAA,eACtD,GAAG;AAAA,MAAC;AAAA,IACd;AAAA,IACD,MAAM,kBAAkB;;AACtB,UAAI;AACF,cAAM,MAAM,MAAM,KAAK,KAAK,SAAS,cAAa;AAClD,cAAM,WAAW,IAAI,CAAC,KAAK;AAC3B,YAAI,YAAY,SAAS,eAAe,OAAO,SAAS,QAAQ,SAAS,KAAK,SAAS,KAAK;AAC1F,eAAK,aAAa,SAAS,KAAK,QAAQ,CAAA;AAAA,eACnC;AACLA,8BAAA,MAAA,QAAA,+BAAa,aAAW,0CAAU,SAAV,mBAAgB,QAAO,MAAM;AAAA,QACvD;AAAA,MACF,SAAS,GAAG;AACVA,sBAAc,MAAA,MAAA,SAAA,+BAAA,WAAW,CAAC;AAAA,MAE5B;AAAA,IACD;AAAA,IACD,MAAM,gBAAgB;;AACpB,WAAK,UAAU;AACf,UAAI;AACF,cAAM,SAAS,EAAE,MAAM,GAAG,UAAU,GAAG,QAAQ,cAAc,WAAW;AACxE,YAAI,KAAK;AAAgB,iBAAO,WAAW,KAAK;AAEhDA,sBAAA,MAAA,MAAA,OAAA,+BAAY,eAAe,MAAM;AACjC,cAAM,MAAM,MAAM,KAAK,KAAK,SAAS,YAAY,MAAM;AACvD,cAAM,WAAW,IAAI,CAAC,KAAK;AAE3BA,sBAAA,MAAA,MAAA,OAAA,+BAAY,aAAa,QAAQ;AAEjC,YAAI,YAAY,SAAS,eAAe,OAAO,SAAS,QAAQ,SAAS,KAAK,SAAS,KAAK;AAC1F,eAAK,WAAW,SAAS,KAAK,KAAK,QAAQ;AAC3CA,8BAAA,MAAA,OAAA,+BAAY,gBAAgB,KAAK,SAAS,QAAQ,KAAK;AAAA,eAClD;AACLA,8BAAA,MAAA,QAAA,+BAAa,eAAa,0CAAU,SAAV,mBAAgB,QAAO,MAAM;AACvD,eAAK,WAAW;QAClB;AAAA,MACF,SAAS,GAAG;AACVA,sBAAA,MAAA,MAAA,SAAA,+BAAc,aAAa,CAAC;AAC5B,aAAK,WAAW;MAClB,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA,IACD,WAAW;AACT,YAAM,WAAW,KAAK,iBAAiB,IAAI,KAAI;AAC/C,WAAK,QAAQ,WAAW,mCAAmC,mBAAmB,OAAO,CAAC,EAAE;AAAA,IACzF;AAAA,IACD,cAAc,MAAM;AAClB,UAAI,QAAQ,KAAK;AAAM,aAAK,QAAQ,WAAW,KAAK,IAAI;AAAA,IACzD;AAAA,IACD,iBAAiB,KAAK;AACpB,WAAK,iBAAiB;AACtB,WAAK,cAAa;AAAA,IACnB;AAAA,IACD,eAAe;AACb,WAAK,QAAQ,UAAU,0BAA0B;AAAA,IAClD;AAAA,IACD,WAAW;AACT,WAAK,QAAQ,UAAU,2BAA2B;AAAA,IACnD;AAAA,IACD,aAAa;AACX,WAAK,QAAQ,WAAW,uBAAuB;AAAA,IAChD;AAAA,IACD,cAAc;AACZ,WAAK,QAAQ,UAAU,wBAAwB;AAAA,IAChD;AAAA,IACD,gBAAgB,IAAI;AAClB,WAAK,QAAQ,WAAW,iCAAiC,EAAE,EAAE;AAAA,IAC9D;AAAA,IACD,YAAY,GAAG;AACb,YAAM,IAAI,OAAO,KAAK,CAAC;AACvB,aAAO,EAAE,QAAQ,CAAC;AAAA,IACpB;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/KA,GAAG,WAAW,eAAe;"}