{"version":3,"file":"my-orders.js","sources":["pages/home/my-orders.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9teS1vcmRlcnMudnVl"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view class=\"tabs\">\r\n      <view :class=\"['tab', status==='' ? 'active' : '']\" @click=\"switchStatus('')\">全部</view>\r\n      <view :class=\"['tab', status==='pending' ? 'active' : '']\" @click=\"switchStatus('pending')\">待支付</view>\r\n      <view :class=\"['tab', status==='paid' ? 'active' : '']\" @click=\"switchStatus('paid')\">已支付</view>\r\n      <view :class=\"['tab', status==='shipped' ? 'active' : '']\" @click=\"switchStatus('shipped')\">已发货</view>\r\n      <view :class=\"['tab', status==='finished' ? 'active' : '']\" @click=\"switchStatus('finished')\">已完成</view>\r\n      <view :class=\"['tab', status==='cancelled' ? 'active' : '']\" @click=\"switchStatus('cancelled')\">已取消</view>\r\n\r\n    </view>\r\n\r\n    <view class=\"order-list\">\r\n      <view class=\"order-card\" v-for=\"order in orders\" :key=\"order.id\" @click=\"goDetail(order.id)\">\r\n        <view class=\"row\">\r\n          <text class=\"order-no\">订单号：{{ order.order_no }}</text>\r\n          <text class=\"badge\">{{ mapStatus(order.status) }}</text>\r\n        </view>\r\n        <view class=\"row small\">{{ order.created_at }}</view>\r\n        <view class=\"row total\">总额：¥ {{ formatPrice(order.total_price) }}</view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"loading\" v-if=\"loading\">加载中...</view>\r\n    <view class=\"empty\" v-if=\"!loading && !orders.length\">暂无订单</view>\r\n\r\n    <view class=\"load-more\" v-if=\"hasMore && !loading\">\r\n      <button class=\"more-btn\" @click=\"loadMore\">加载更多</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      status: '',\r\n      orders: [],\r\n      page: 1,\r\n      pageSize: 10,\r\n      totalPages: 1,\r\n      loading: false,\r\n      hasMore: false\r\n    };\r\n  },\r\n  onShow() {\r\n    if (!this.ensureLogin()) return;\r\n    this.fetchOrders(true);\r\n  },\r\n  methods: {\r\n    async fetchOrders(reset = false) {\r\n      if (reset) {\r\n        this.page = 1;\r\n        this.orders = [];\r\n      }\r\n      this.loading = true;\r\n      try {\r\n        const res = await this.$api.orders.getOrders({\r\n          status: this.status,\r\n          page: this.page,\r\n          pageSize: this.pageSize\r\n        });\r\n        const r = res[1] || res;\r\n        if (r && r.statusCode >= 200 && r.statusCode < 300 && r.data && r.data.code === 200) {\r\n          const { list = [], pagination = {} } = r.data.data || {};\r\n          this.orders = this.orders.concat(list);\r\n          this.totalPages = Number(pagination.totalPages || 1);\r\n          this.hasMore = this.page < this.totalPages;\r\n        } else {\r\n          uni.showToast({ title: r?.data?.msg || '加载失败', icon: 'none' });\r\n        }\r\n      } catch (e) {\r\n        uni.showToast({ title: '网络错误', icon: 'none' });\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    switchStatus(s) {\r\n      this.status = s;\r\n      this.fetchOrders(true);\r\n    },\r\n    loadMore() {\r\n      if (this.hasMore && !this.loading) {\r\n        this.page += 1;\r\n        this.fetchOrders(false);\r\n      }\r\n    },\r\n    goDetail(id) {\r\n      this.$router.navigateTo(`/pages/home/order-detail?id=${id}`);\r\n    },\r\n    mapStatus(s) {\r\n      const m = {\r\n        pending: '待支付',\r\n        paid: '已支付',\r\n        shipped: '已发货',\r\n        finished: '已完成',\r\n        cancelled: '已取消'\r\n      };\r\n      return m[s] || '未知';\r\n    },\r\n    ensureLogin() {\r\n      const token = uni.getStorageSync('token');\r\n      if (!token) {\r\n        uni.showToast({ title: '请先登录', icon: 'none' });\r\n        setTimeout(() => this.$router.switchTab('/pages/account/profile'), 500);\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    formatPrice(v) {\r\n      const n = Number(v || 0);\r\n      return n.toFixed(2);\r\n    },\r\n    // 可选：本地格式化时间\r\n    fmtTime(ts) {\r\n      if (!ts) return '';\r\n      const d = new Date(ts);\r\n      return d.toLocaleString('zh-CN');\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.page { background: #f5f5f5; min-height: 100vh; }\r\n.tabs { display: flex; background: #fff; margin: 12rpx; border-radius: 12rpx; overflow: hidden; }\r\n.tab { flex: 1; text-align: center; padding: 20rpx 0; color: #333; }\r\n.tab.active { color: #07c160; font-weight: 700; border-bottom: 4rpx solid #07c160; }\r\n.order-list { margin: 12rpx; }\r\n.order-card { background: #fff; border-radius: 12rpx; padding: 16rpx; margin-bottom: 12rpx; }\r\n.row { display: flex; justify-content: space-between; align-items: center; }\r\n.row.small { color: #999; font-size: 24rpx; margin-top: 4rpx; }\r\n.order-no { color: #111; font-size: 28rpx; }\r\n.badge { color: #07c160; font-size: 24rpx; }\r\n.total { color: #e33; font-weight: 700; margin-top: 4rpx; }\r\n.loading, .empty, .load-more { text-align: center; color: #666; padding: 24rpx 0; }\r\n.more-btn { background: #07c160; color: #fff; border-radius: 999rpx; font-size: 26rpx; padding: 0 36rpx; }\r\n</style>\r\n","import MiniProgramPage from 'D:/newSunShinestore/frontend/newSunShineFrontend/pages/home/my-orders.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAiCA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,QAAQ;AAAA,MACR,QAAQ,CAAE;AAAA,MACV,MAAM;AAAA,MACN,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,SAAS;AAAA;EAEZ;AAAA,EACD,SAAS;AACP,QAAI,CAAC,KAAK,YAAW;AAAI;AACzB,SAAK,YAAY,IAAI;AAAA,EACtB;AAAA,EACD,SAAS;AAAA,IACP,MAAM,YAAY,QAAQ,OAAO;;AAC/B,UAAI,OAAO;AACT,aAAK,OAAO;AACZ,aAAK,SAAS;MAChB;AACA,WAAK,UAAU;AACf,UAAI;AACF,cAAM,MAAM,MAAM,KAAK,KAAK,OAAO,UAAU;AAAA,UAC3C,QAAQ,KAAK;AAAA,UACb,MAAM,KAAK;AAAA,UACX,UAAU,KAAK;AAAA,QACjB,CAAC;AACD,cAAM,IAAI,IAAI,CAAC,KAAK;AACpB,YAAI,KAAK,EAAE,cAAc,OAAO,EAAE,aAAa,OAAO,EAAE,QAAQ,EAAE,KAAK,SAAS,KAAK;AACnF,gBAAM,EAAE,OAAO,CAAE,GAAE,aAAa,CAAA,MAAO,EAAE,KAAK,QAAQ;AACtD,eAAK,SAAS,KAAK,OAAO,OAAO,IAAI;AACrC,eAAK,aAAa,OAAO,WAAW,cAAc,CAAC;AACnD,eAAK,UAAU,KAAK,OAAO,KAAK;AAAA,eAC3B;AACLA,wBAAAA,MAAI,UAAU,EAAE,SAAO,4BAAG,SAAH,mBAAS,QAAO,QAAQ,MAAM,OAAO,CAAC;AAAA,QAC/D;AAAA,MACF,SAAS,GAAG;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC/C,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA,IACD,aAAa,GAAG;AACd,WAAK,SAAS;AACd,WAAK,YAAY,IAAI;AAAA,IACtB;AAAA,IACD,WAAW;AACT,UAAI,KAAK,WAAW,CAAC,KAAK,SAAS;AACjC,aAAK,QAAQ;AACb,aAAK,YAAY,KAAK;AAAA,MACxB;AAAA,IACD;AAAA,IACD,SAAS,IAAI;AACX,WAAK,QAAQ,WAAW,+BAA+B,EAAE,EAAE;AAAA,IAC5D;AAAA,IACD,UAAU,GAAG;AACX,YAAM,IAAI;AAAA,QACR,SAAS;AAAA,QACT,MAAM;AAAA,QACN,SAAS;AAAA,QACT,UAAU;AAAA,QACV,WAAW;AAAA;AAEb,aAAO,EAAE,CAAC,KAAK;AAAA,IAChB;AAAA,IACD,cAAc;AACZ,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAI,CAAC,OAAO;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAC7C,mBAAW,MAAM,KAAK,QAAQ,UAAU,wBAAwB,GAAG,GAAG;AACtE,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACR;AAAA,IACD,YAAY,GAAG;AACb,YAAM,IAAI,OAAO,KAAK,CAAC;AACvB,aAAO,EAAE,QAAQ,CAAC;AAAA,IACnB;AAAA;AAAA,IAED,QAAQ,IAAI;AACV,UAAI,CAAC;AAAI,eAAO;AAChB,YAAM,IAAI,IAAI,KAAK,EAAE;AACrB,aAAO,EAAE,eAAe,OAAO;AAAA,IACjC;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvHA,GAAG,WAAW,eAAe;"}