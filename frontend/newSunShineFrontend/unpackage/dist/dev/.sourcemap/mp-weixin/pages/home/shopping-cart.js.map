{"version":3,"file":"shopping-cart.js","sources":["pages/home/shopping-cart.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9zaG9wcGluZy1jYXJ0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view v-if=\"loading\" class=\"loading\">加载中...</view>\r\n    <view v-else>\r\n      <view v-if=\"!items.length\" class=\"empty\">\r\n        <text>购物车为空</text>\r\n        <button class=\"shop-btn\" @click=\"goToProducts\">去逛逛</button>\r\n      </view>\r\n\r\n      <view v-else class=\"list\">\r\n        <view class=\"cart-item\" v-for=\"item in items\" :key=\"item.id\">\r\n          <image class=\"thumb\" :src=\"item.image || defaultImage\" mode=\"aspectFill\" />\r\n          <view class=\"info\">\r\n            <view class=\"name\">{{ item.name }}</view>\r\n            <view class=\"meta\">\r\n              <text class=\"price\">¥ {{ formatPrice(item.price) }}</text>\r\n              <view class=\"stepper\">\r\n                <button class=\"q-btn\" @click=\"updateQty(item, item.quantity - 1)\" :disabled=\"item.quantity<=1\">-</button>\r\n                <text class=\"q-num\">{{ item.quantity }}</text>\r\n                <button class=\"q-btn\" @click=\"updateQty(item, item.quantity + 1)\">+</button>\r\n              </view>\r\n            </view>\r\n          </view>\r\n          <button class=\"del-btn\" @click=\"removeItem(item.id)\">删除</button>\r\n        </view>\r\n\r\n        <view class=\"summary\">\r\n          <text>共 {{ items.length }} 件</text>\r\n          <text class=\"sum\">合计：¥ {{ formatPrice(totalAmount) }}</text>\r\n        </view>\r\n\r\n        <view class=\"actions\">\r\n          <button class=\"clear-btn\" @click=\"clearCart\">清空</button>\r\n          <button class=\"checkout-btn\" @click=\"goCheckout\">去结算</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      items: [],\r\n      loading: true,\r\n      defaultImage: '/static/logo.png'\r\n    };\r\n  },\r\n  computed: {\r\n    totalAmount() {\r\n      return this.items.reduce((sum, it) => sum + Number(it.price) * Number(it.quantity), 0);\r\n    }\r\n  },\r\n  onShow() {\r\n    this.fetchCart();\r\n  },\r\n  methods: {\r\n    async fetchCart() {\r\n      if (!this.ensureLogin()) return;\r\n      this.loading = true;\r\n      try {\r\n        const res = await this.$api.cart.getCart();\r\n        const response = res[1] || res;\r\n        if (response && response.statusCode === 200 && response.data && response.data.code === 200) {\r\n         \r\n          const cart = response.data.data || { items: [], totalPrice: 0, totalItems: 0 };\r\n         this.items = cart.items;\r\n        } else {\r\n          this.items = [];\r\n        }\r\n      } catch (e) {\r\n        this.items = [];\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    async updateQty(item, nextQty) {\r\n      if (nextQty < 1) return;\r\n      try {\r\n        const res = await this.$api.cart.updateCartQuantity(item.id, { quantity: nextQty });\r\n        const response = res[1] || res;\r\n        if (response && response.statusCode === 200 && (response.data.code === 200)) {\r\n          item.quantity = nextQty;\r\n          this.$forceUpdate();\r\n        } else {\r\n          uni.showToast({ title: response.data.msg || '更新失败', icon: 'none' });\r\n        }\r\n      } catch (e) {\r\n        uni.showToast({ title: '更新失败', icon: 'none' });\r\n      }\r\n    },\r\n    async removeItem(cartId) {\r\n      try {\r\n        const res = await this.$api.cart.removeFromCart(cartId);\r\n        const response = res[1] || res;\r\n        if (response && response.statusCode === 200 && response.data.code === 200) {\r\n          this.items = this.items.filter(it => it.id !== cartId);\r\n        } else {\r\n          uni.showToast({ title: response.data.msg || '删除失败', icon: 'none' });\r\n        }\r\n      } catch (e) {\r\n        uni.showToast({ title: '删除失败', icon: 'none' });\r\n      }\r\n    },\r\n    async clearCart() {\r\n      try {\r\n        const res = await this.$api.cart.clearCart();\r\n        const response = res[1] || res;\r\n        if (response && response.statusCode === 200 && response.data.code === 200) {\r\n          this.items = [];\r\n        } else {\r\n          uni.showToast({ title: response.data.msg || '清空失败', icon: 'none' });\r\n        }\r\n      } catch (e) {\r\n        uni.showToast({ title: '清空失败', icon: 'none' });\r\n      }\r\n    },\r\n    goCheckout() {\r\n      if (!this.ensureLogin()) return;\r\n      // 购物车直接结算：将服务器返回的行转换为下单项\r\n      const checkoutItems = this.items.map(it => ({ product_id: it.product_id, quantity: it.quantity, price: it.price, name: it.name, image: it.image }));\r\n      uni.setStorageSync('checkout_items', checkoutItems);\r\n      this.$router.navigateTo('/pages/home/checkout');\r\n    },\r\n    goToProducts() {\r\n      this.$router.switchTab('/pages/home/product-list');\r\n    },\r\n    ensureLogin() {\r\n      const token = uni.getStorageSync('token');\r\n      if (!token) {\r\n        uni.showToast({ title: '请先登录', icon: 'none' });\r\n        setTimeout(() => this.$router.switchTab('/pages/account/profile'), 500);\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    formatPrice(v) {\r\n      const n = Number(v || 0);\r\n      return n.toFixed(2);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.page { background: #f5f5f5; min-height: 100vh; }\r\n.loading, .empty { text-align: center; color: #666; padding: 48rpx 0; }\r\n.shop-btn { background: #07c160; color: #fff; margin-top: 16rpx; border-radius: 12rpx; }\r\n.list { padding: 12rpx; }\r\n.cart-item { display: flex; align-items: center; background: #fff; border-radius: 12rpx; padding: 12rpx; margin: 12rpx; }\r\n.thumb { width: 140rpx; height: 140rpx; background: #f0f0f0; border-radius: 8rpx; }\r\n.info { flex: 1; margin-left: 12rpx; }\r\n.name { font-size: 28rpx; color: #111; line-height: 40rpx; }\r\n.meta { display: flex; align-items: center; justify-content: space-between; margin-top: 8rpx; }\r\n.price { color: #e33; font-weight: 700; }\r\n.stepper { display: flex; align-items: center; }\r\n.q-btn { width: 56rpx; height: 56rpx; text-align: center; line-height: 56rpx; background: #f6f6f6; border-radius: 8rpx; }\r\n.q-num { width: 72rpx; text-align: center; }\r\n.del-btn { margin-left: 8rpx; background: #ff4d4f; color: #fff; border-radius: 8rpx; }\r\n.summary { display: flex; justify-content: space-between; padding: 0 24rpx; margin-top: 8rpx; color: #333; }\r\n.sum { color: #e33; font-weight: 700; }\r\n.actions { display: flex; padding: 12rpx; }\r\n.clear-btn { flex: 1; margin-right: 8rpx; background: #f2f2f2; color: #333; border-radius: 12rpx; }\r\n.checkout-btn { flex: 1; margin-left: 8rpx; background: #07c160; color: #fff; border-radius: 12rpx; }\r\n</style>\r\n","import MiniProgramPage from 'D:/newSunShinestore/frontend/newSunShineFrontend/pages/home/shopping-cart.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}