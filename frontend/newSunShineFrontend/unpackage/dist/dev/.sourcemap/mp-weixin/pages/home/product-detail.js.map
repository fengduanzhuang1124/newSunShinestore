{"version":3,"file":"product-detail.js","sources":["pages/home/product-detail.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9wcm9kdWN0LWRldGFpbC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view v-if=\"loading\" class=\"loading\">加载中...</view>\r\n    <view v-else>\r\n      <!-- 图集/主图 -->\r\n      <image class=\"cover\" :src=\"detail.image || defaultImage\" mode=\"aspectFill\" />\r\n\r\n      <!-- 基本信息 -->\r\n      <view class=\"info\">\r\n        <view class=\"name\">{{ detail.name }}</view>\r\n        <view class=\"meta\">\r\n          <text class=\"price\">¥ {{ formatPrice(detail.price) }}</text>\r\n          <text class=\"stock\">库存：{{ detail.stock }}</text>\r\n        </view>\r\n        <view class=\"tags\">\r\n          <text v-if=\"detail.category\" class=\"tag\">{{ detail.category }}</text>\r\n          <text v-if=\"detail.status === 'off'\" class=\"tag off\">已下架</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 数量选择 -->\r\n      <view class=\"quantity\">\r\n        <text class=\"q-label\">数量</text>\r\n        <view class=\"stepper\">\r\n          <button class=\"q-btn\" @click=\"dec\">-</button>\r\n          <input class=\"q-input\" type=\"number\" v-model.number=\"quantity\" />\r\n          <button class=\"q-btn\" @click=\"inc\">+</button>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 详情描述 -->\r\n      <view class=\"desc\">\r\n        <view class=\"desc-title\">商品详情</view>\r\n        <text class=\"desc-text\">{{ detail.description || '暂无详情' }}</text>\r\n      </view>\r\n\r\n      <!-- 底部操作栏 -->\r\n      <view class=\"bottom-bar\">\r\n        <button class=\"cart-btn\" @click=\"goCart\">购物车</button>\r\n        <button class=\"add-btn\" :disabled=\"!canBuy\" @click=\"handleAddToCart\">加入购物车</button>\r\n        <button class=\"buy-btn\" :disabled=\"!canBuy\" @click=\"handleBuyNow\">立即购买</button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      productId: null,\r\n      detail: {},\r\n      loading: true,\r\n      quantity: 1,\r\n      defaultImage: '/static/logo.png'\r\n    };\r\n  },\r\n  computed: {\r\n    canBuy() {\r\n      return this.detail && this.detail.status !== 'off' && Number(this.detail.stock) > 0;\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    this.productId = options.id;\r\n    this.fetchDetail();\r\n  },\r\n  methods: {\r\n    async fetchDetail() {\r\n      this.loading = true;\r\n      try {\r\n        const res = await this.$api.products.getProduct(this.productId);\r\n        const response = res[1] || res;\r\n        if (response && response.statusCode === 200 && response.data && response.data.code === 200) {\r\n          this.detail = response.data.data || {};\r\n        }\r\n      } catch (e) {\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    inc() {\r\n      const max = Number(this.detail.stock || 1);\r\n      if (this.quantity < max) this.quantity += 1;\r\n    },\r\n    dec() {\r\n      if (this.quantity > 1) this.quantity -= 1;\r\n    },\r\n    async handleAddToCart() {\r\n      if (!this.ensureLogin()) return;\r\n      try {\r\n        const payload = { product_id: Number(this.productId), quantity: Number(this.quantity) };\r\n        const res = await this.$api.cart.addToCart(payload);\r\n        const response = res[1] || res;\r\n        if (response && response.statusCode >= 200 && response.statusCode < 300 && (response.data.code === 200 || response.data.code === 201)) {\r\n\r\n          uni.showToast({ title: '已加入购物车', icon: 'success' });\r\n        } else {\r\n          uni.showToast({ title: response.data.msg || '加入失败', icon: 'none' });\r\n        }\r\n      } catch (e) {\r\n        uni.showToast({ title: '加入失败', icon: 'none' });\r\n      }\r\n    },\r\n    handleBuyNow() {\r\n      if (!this.ensureLogin()) return;\r\n      const item = { product_id: Number(this.productId), quantity: Number(this.quantity), price: Number(this.detail.price), name: this.detail.name, image: this.detail.image };\r\n      uni.setStorageSync('checkout_items', [item]);\r\n      this.$router.navigateTo('/pages/home/checkout');\r\n    },\r\n    goCart() {\r\n      this.$router.switchTab('/pages/home/shopping-cart');\r\n    },\r\n    ensureLogin() {\r\n      const token = uni.getStorageSync('token');\r\n      if (!token) {\r\n        uni.showToast({ title: '请先登录', icon: 'none' });\r\n        setTimeout(() => this.$router.switchTab('/pages/account/profile'), 500);\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    formatPrice(v) {\r\n      const n = Number(v || 0);\r\n      return n.toFixed(2);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.page { background: #f5f5f5; min-height: 100vh; padding-bottom: 120rpx; }\r\n.loading { text-align: center; color: #666; padding: 48rpx 0; }\r\n.cover { width: 100%; height: 480rpx; background: #f0f0f0; }\r\n.info { background: #fff; margin: 12rpx; border-radius: 12rpx; padding: 16rpx; }\r\n.name { font-size: 32rpx; color: #111; font-weight: 600; }\r\n.meta { display: flex; justify-content: space-between; margin-top: 8rpx; }\r\n.price { color: #e33; font-weight: 700; }\r\n.stock { color: #666; }\r\n.tags { margin-top: 8rpx; }\r\n.tag { display: inline-block; background: #f6f6f6; color: #666; border-radius: 999rpx; padding: 6rpx 16rpx; font-size: 22rpx; margin-right: 8rpx; }\r\n.tag.off { background: #ffecec; color: #e33; }\r\n.quantity { background: #fff; margin: 12rpx; border-radius: 12rpx; padding: 16rpx; display: flex; align-items: center; justify-content: space-between; }\r\n.q-label { color: #333; }\r\n.stepper { display: flex; align-items: center; }\r\n.q-btn { width: 64rpx; height: 64rpx; text-align: center; line-height: 64rpx; background: #f6f6f6; border-radius: 8rpx; }\r\n.q-input { width: 120rpx; margin: 0 8rpx; background: #fff; border: 1px solid #eee; border-radius: 8rpx; text-align: center; }\r\n.desc { background: #fff; margin: 12rpx; border-radius: 12rpx; padding: 16rpx; }\r\n.desc-title { font-size: 28rpx; color: #111; margin-bottom: 8rpx; }\r\n.desc-text { font-size: 26rpx; color: #666; line-height: 44rpx; }\r\n.bottom-bar { position: fixed; left: 0; right: 0; bottom: 0; display: flex; background: #fff; padding: 12rpx; box-shadow: 0 -6rpx 12rpx rgba(0,0,0,0.04); }\r\n.cart-btn { flex: 1; margin-right: 8rpx; background: #f2f2f2; color: #333; border-radius: 12rpx; }\r\n.add-btn { flex: 1; margin: 0 8rpx; background: #07c160; color: #fff; border-radius: 12rpx; }\r\n.buy-btn { flex: 1; margin-left: 8rpx; background: #ff6a00; color: #fff; border-radius: 12rpx; }\r\n</style>\r\n","import MiniProgramPage from 'D:/newSunShinestore/frontend/newSunShineFrontend/pages/home/product-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}